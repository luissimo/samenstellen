!function(t,e){var s=0,n={},r={},i=Array.prototype.slice,a=function(e){return t.isArray(e)?e:[e]},o="id",c="form",h="disabled",l="wizard",p="default",d="number",u="boolean";t.each("branch form header step wrapper".split(" "),function(){n[this]="."+(r[this]=l+"-"+this)}),t.widget("kf."+l,{version:"1.0.0",options:{animations:{show:{options:{duration:0},properties:{opacity:"show"}},hide:{options:{duration:0},properties:{opacity:"hide"}}},backward:".backward",branches:".branch",disabled:!1,enableSubmit:!1,forward:".forward",header:":header:first",initialStep:0,stateAttribute:"data-state",stepClasses:{current:"current",exclude:"exclude",stop:"stop",submit:"submit",unidirectional:"unidirectional"},steps:".step",submit:":submit",transitions:{},unidirectional:!1,afterBackward:null,afterDestroy:null,afterForward:null,afterSelect:null,beforeBackward:null,beforeDestroy:null,beforeForward:null,beforeSelect:null,create:null},_create:function(){var e,i,h=this,d=h.options,u=h.element,f=u.find(d.steps),b=f.eq(0).parent();u[0].elements?e=u:(e=u.find(c)).length||(e=u.closest(c)),(i=u.find(d.header)).length||(i=e.find(d.header)),h.elements={form:e.addClass(r.form),submit:e.find(d.submit),forward:e.find(d.forward),backward:e.find(d.backward),header:i.addClass(r.header),steps:u.find(d.steps).hide().addClass(r.step),branches:u.find(d.branches).add(b).addClass(r.branch),stepsWrapper:b.addClass(r.wrapper),wizard:u.addClass(l)},b.attr(o)||b.attr(o,l+"-"+ ++s),h.elements.forward.click(function(t){t.preventDefault(),h.forward(t)}),h.elements.backward.click(function(t){t.preventDefault(),h.backward(t)}),h._currentState={branchesActivated:[],stepsActivated:[]},h._stepCount=h.elements.steps.length,h._lastStepIndex=h._stepCount-1,h._branchLabels=[],h.elements.steps.each(function(e){h._branchLabels[e]=t(this).parent().attr(o)}),h._excludesFilter=function(){return!t(this).hasClass(d.stepClasses.exclude)},d.transitions[p]||(d.transitions[p]=function(t){return h.stepIndex(t.nextAll(n.step))}),h.select.apply(h,a(d.initialStep))},_fastForward:function(s,n,r){var i=0,a=this,o=a._currentState.stepIndex,c=[o];t.isFunction(n)&&(r=n,n=e),function e(){a._transition(o,function(h,l){if(-1===(o=a.stepIndex(h,l)))throw new Error('[_fastForward]: Invalid step "'+h+'"');if(t.inArray(o,c)>=0)throw new Error('[_fastForward]: Recursion detected on step "'+h+'"');c.push(o),o===a._lastStepIndex||(n?++i:o)===s?r.call(a,o,c):e()})}()},_find:function(e,s,n){function r(t,e){if(e===h)return i=e,!1}var i,o,c,h,l,p=[],u=s instanceof jQuery?s:t(s);if(null!==e&&u.length)for(e=a(e),o=0,c=e.length;o<c;o++)i=null,h=e[o],l=typeof h,l===d?i=u.get(h):"string"===l?i=document.getElementById(h.replace("#","")):"object"===l&&(h instanceof jQuery&&h.length&&(h=h[0]),h.nodeType&&u.each(r)),i&&p.push(i);return!1===n?p:t(p)},_move:function(s,n,r,i,a){function o(s,n){a.call(c,s,t.isArray(i)?i:!1!==i?n:e)}var c=this,h=c._currentState;typeof n===u&&(a=i,i=r,r=n,n=e),!0===r?s>0?c._fastForward(s,r,o):a.call(c,h.stepsActivated[Math.max(0,s+(h.stepsActivated.length-1))]):-1!==(s=c.stepIndex(s,n))&&(s>h.stepIndex?c._fastForward(s,o):o.call(c,s))},_state:function(e,s){if(!this.isValidStepIndex(e))return null;var r=(this.options,t.extend(!0,{},this._currentState));s=a(s||e),r.step=this.elements.steps.eq(e),r.branch=r.step.parent(),r.branchStepCount=r.branch.children(n.step).length,r.isMovingForward=e>r.stepIndex,r.stepIndexInBranch=r.branch.children(n.step).index(r.step);for(var i,o,c,h=0,l=s.length;h<l;h++)e=s[h],i=this._branchLabels[e],!r.stepIndex||r.stepIndex<e?t.inArray(e,r.stepsActivated)<0&&(r.stepsActivated.push(e),t.inArray(i,r.branchesActivated)<0&&r.branchesActivated.push(i)):r.stepIndex>e&&(o=t.inArray(i,r.branchesActivated)+1,c=t.inArray(e,r.stepsActivated)+1,o>0&&r.branchesActivated.splice(o,r.branchesActivated.length-1),c>0&&r.stepsActivated.splice(c,r.stepsActivated.length-1)),r.stepIndex=e,r.branchLabel=i;return r.stepsComplete=Math.max(0,this._find(r.stepsActivated,this.elements.steps).filter(this._excludesFilter).length-1),r.stepsPossible=Math.max(0,this._find(r.branchesActivated,this.elements.branches).children(n.step).filter(this._excludesFilter).length-1),t.extend(r,{branchLabel:this._branchLabels[e],isFirstStep:0===e,isFirstStepInBranch:0===r.stepIndexInBranch,isLastStep:e===this._lastStepIndex,isLastStepInBranch:r.stepIndexInBranch===r.branchStepCount-1,percentComplete:100*r.stepsComplete/r.stepsPossible,stepsRemaining:r.stepsPossible-r.stepsComplete}),r},_transition:function(s,n,r){var o=this;t.isFunction(s)?(r=s,s=o._currentState.stepIndex,n=e):t.isFunction(n)&&(r=n,n=e);var c,h=o.options,l=o.step(s,n),d=l.attr(h.stateAttribute),u=d?h.transitions[d]:h.transitions[p];return c=t.isFunction(u)?u.call(o,l,function(){return r.apply(o,i.call(arguments))}):d,c!==e&&!1!==c&&r.apply(o,a(c)),c},_update:function(e,s){var n=this._currentState,r=this.options;if(n.step){if(r.disabled||!s||s.stepIndex===n.stepIndex||!this._trigger("beforeSelect",e,s)||s.isMovingForward&&!this._trigger("beforeForward",e,s)||!s.isMovingForward&&!this._trigger("beforeBackward",e,s))return;n.step.removeClass(r.stepClasses.current).animate(r.animations.hide.properties,t.extend({},r.animations.hide.options))}this._currentState=s,s.step.addClass(r.stepClasses.current).animate(r.animations.show.properties,t.extend({},r.animations.show.options)),s.isFirstStep||r.unidirectional||s.step.hasClass(r.stepClasses.unidirectional)?this.elements.backward.attr(h,!0):this.elements.backward.removeAttr(h),s.isLastStepInBranch&&!s.step.attr(r.stateAttribute)||s.step.hasClass(r.stepClasses.stop)?this.elements.forward.attr(h,!0):this.elements.forward.removeAttr(h),r.enableSubmit||s.step.hasClass(r.stepClasses.submit)?this.elements.submit.removeAttr(h):this.elements.submit.attr(h,!0),n.step&&(this._trigger("afterSelect",e,s),this._trigger(s.isMovingForward?"afterForward":"afterBackward",e,s))},backward:function(t,s){typeof t===d&&(s=t,t=e),s===e&&(s=1),this._currentState.isFirstStep||typeof s!==d||this._move(-s,!0,!1,function(e,s){this._update(t,this._state(e,s))})},branch:function(t){return arguments.length?this._find(t,this.elements.branches):this._currentState.branch},branches:function(t){return arguments.length?this.branch(t).children(n.branch):this.elements.branches},branchesActivated:function(){return this._find(this._currentState.branchesActivated,this.elements.branches)},destroy:function(){var e=this.elements;this._trigger("beforeDestroy",null,this.state())&&(this.element.removeClass(l),e.form.removeClass(r.form),e.header.removeClass(r.header),e.steps.show().removeClass(r.step),e.stepsWrapper.removeClass(r.wrapper),e.branches.removeClass(r.branch),t.Widget.prototype.destroy.call(this),this._trigger("afterDestroy"))},form:function(){return this.elements.form},forward:function(t,s,n){typeof t===d&&(n=s,s=t,t=e),s===e&&(s=1),this._currentState.isLastStep||typeof s!==d||this._move(s,!0,n,function(e,s){this._update(t,this._state(e,s))})},isValidStep:function(t,e){return this.isValidStepIndex(this.stepIndex(t,e))},isValidStepIndex:function(t){return typeof t===d&&t>=0&&t<=this._lastStepIndex},stepCount:function(){return this._stepCount},select:function(s,n,r,i,a){s instanceof t.Event||(a=i,i=r,r=n,n=s,s=e),n!==e&&(t.isArray(n)?(a=i,i=r,r=n[1],n=n[0]):typeof r===u?(a=i,i=r,r=e):t.isArray(r)&&(a=r,r=e),this._move(n,r,i,a,function(t,e){this._update(s,this._state(t,e))}))},state:function(s,n,r){return arguments.length?(t.isArray(s)?(r=n,n=s[1],s=s[0]):t.isArray(n)&&(r=n,n=e),this._state(this.stepIndex(s,n),r)):this._currentState},step:function(s,n){if(!arguments.length)return this._currentState.step;t.isArray(s)&&(n=s[1],s=s[0]);var i;return typeof s===d?i=this._find(s,n!==e?this.steps(n):this.elements.steps):(i=this._find(s,this.elements.steps.add(this.elements.branches)))&&i.hasClass(r.branch)&&(i=this._find(n||0,this.steps(i))),i},stepIndex:function(s,r,i){if(!arguments.length)return this._currentState.stepIndex;var a;return t.isArray(s)?(i=r,r=s[1],s=s[0]):typeof r===u&&(i=r,r=e),(a=this.step(s,r))?(i?a.siblings(n.step).andSelf():this.elements.steps).index(a):-1},steps:function(t){return arguments.length?this.branch(t).children(n.step):this.elements.steps},stepsActivated:function(){return this._find(this._currentState.stepsActivated,this.elements.steps)},submit:function(){this.elements.form.submit()}})}(jQuery);